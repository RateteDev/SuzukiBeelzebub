# Discord Bot コマンド仕様書

## 概要
このボットは、テキストチャンネルでの会話の要約・分析機能と、ボイスチャンネルでのテキスト読み上げ機能を提供します。

## コマンド一覧

### `/要約`
- **説明**: 過去24時間分のチャンネルメッセージを要約
- **動作**:
  - 非ボットユーザーのメッセージのみを収集
  - Gemini AIを使用して要約を生成
  - 結果を埋め込みメッセージで表示
- **応答**:
  - 要約結果（埋め込みメッセージ）
  - "処理が終了しました"メッセージ

### `/要約silent`
- **説明**: 要約結果を実行者にのみ表示
- **動作**: `/要約`と同様
- **応答**: 実行者にのみ要約結果を表示

### `/今北産業`
- **説明**: 過去の100投稿を3行にまとめて表示
- **動作**:
  - 非ボットユーザーのメッセージを収集（最大100件）
  - Gemini AIを使用して3行要約を生成
- **応答**:
  - 3行要約結果（埋め込みメッセージ）
  - "処理が終了しました"メッセージ

### `/今北産業silent`
- **説明**: 過去の100投稿を3行にまとめて実行者にのみ表示
- **動作**:
  - 非ボットユーザーのメッセージを収集（最大100件）
  - Gemini AIを使用して3行要約を生成
- **応答**: 実行者にのみ3行要約を表示

### `/年齢推定`
- **説明**: ユーザーの投稿から年齢を推定し表示
- **動作**:
  - 全チャンネルから実行者の過去メッセージを収集
  - Gemini AIを使用して年齢推定を実行
- **応答**:
  - 年齢推定結果（埋め込みメッセージ）
  - "処理が終了しました"メッセージ

### `/年齢推定silent`
- **説明**: ユーザーの投稿から年齢を推定して実行者にのみ表示
- **動作**:
  - 全チャンネルから実行者の過去メッセージを収集
  - Gemini AIを使用して年齢推定を実行
- **応答**: 実行者にのみ推定結果を表示

### `/mvp`
- **説明**: 過去24時間で最も印象的な発言を選出
- **動作**:
  - 非ボットユーザーのメッセージを収集
  - Gemini AIを使用してMVPを選出
  - 選出理由と共に結果を表示
- **応答**:
  - MVP選出結果（埋め込みメッセージ）
  - "処理が終了しました"メッセージ

### `/mvp_silent`
- **説明**: MVP結果を実行者にのみ表示
- **動作**: `/mvp`と同様
- **応答**: 実行者にのみMVP結果を表示

### `/性格分析mbti`
- **説明**: ユーザーの投稿からMBTI性格タイプを分析
- **動作**:
  - 全チャンネルから実行者の過去メッセージを収集（最大100件/チャンネル）
  - Gemini AIを使用してMBTI分析を実行
- **応答**:
  - MBTI分析結果（埋め込みメッセージ）
  - 各タイプの詳細な説明
  - "処理が終了しました"メッセージ

### `/性格分析mbti_silent`
- **説明**: MBTI分析結果を実行者にのみ表示
- **動作**: `/性格分析mbti`と同様
- **応答**: 実行者にのみ分析結果を表示

### `/性格分析big5`
- **説明**: ユーザーの投稿からBIG5性格特性を分析
- **動作**:
  - 全チャンネルから実行者の過去メッセージを収集（最大100件/チャンネル）
  - Gemini AIを使用してBIG5分析を実行
- **応答**:
  - BIG5分析結果（埋め込みメッセージ）
  - 各特性の詳細な説明
  - "処理が終了しました"メッセージ

### `/性格分析big5_silent`
- **説明**: BIG5分析結果を実行者にのみ表示
- **動作**: `/性格分析big5`と同様
- **応答**: 実行者にのみ分析結果を表示

### `/vc参加`
- **説明**: ボットをボイスチャンネルに参加させる
- **前提条件**: 実行者がVCに参加していること
- **動作**:
  - 実行者のいるVCに参加
  - テキストチャンネルとVCの紐付けを保存
- **応答**: 参加完了メッセージ（実行者にのみ表示）

### `/vc退出`
- **説明**: ボットをボイスチャンネルから退出させる
- **動作**:
  - VCから退出
  - チャンネル紐付けを解除
- **応答**: 退出完了メッセージ（実行者にのみ表示）

### 自動読み上げ機能
- **説明**: VCに参加中、紐付けられたテキストチャンネルのメッセージを読み上げ
- **動作**:
  - メッセージを最大20文字に制限
  - URLや絵文字、メンションを除去
  - Google TTSで音声変換
  - 2倍速で再生
- **制限事項**:
  - ボットのメッセージは読み上げない
  - 指定チャンネル以外のメッセージは読み上げない

## エラーハンドリング

### 共通エラー
- API制限到達時: エラーメッセージを表示
- 権限不足時: 適切なエラーメッセージを表示
- タイムアウト時: エラーメッセージを表示

### VC固有のエラー
- ユーザーがVCに未参加: エラーメッセージを表示
- ボットが既に他のVCに参加中: エラーメッセージを表示
- 音声再生エラー: ログに記録

## 技術的制限事項
1. メッセージ取得制限
   - 要約・MVP: 過去24時間
   - 性格分析: チャンネルあたり最大100件

2. 読み上げ制限
   - 最大20文字
   - 特殊文字は除去
   - 連続メッセージは順次処理
